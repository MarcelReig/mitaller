# MiTaller.art - Marketplace de Artesanos de Menorca

## Contexto del Proyecto
Marketplace multi-vendor SaaS para artesanos de Menorca. Los artesanos pueden:
- Crear perfil p√∫blico con slug √∫nico (/artistas/{slug})
- Gestionar portfolio de obras (galer√≠a de su trabajo)
- Vender productos con Stripe Connect (comisi√≥n 12%)
- Gestionar pedidos desde su dashboard

## Stack Tecnol√≥gico

### Backend (Django)
- Framework: Django 5.0 + Django REST Framework
- Database: PostgreSQL 15
- Auth: JWT (djangorestframework-simplejwt)
- Media: Cloudinary (futuro)
- Payments: Stripe Connect Express (futuro)
- Deploy: Railway

### Frontend (Next.js)
- Framework: Next.js 14 (App Router)
- Language: TypeScript (strict mode)
- Styling: Tailwind CSS + shadcn/ui
- HTTP: Axios + TanStack Query
- State: Zustand (auth + global state)
- Deploy: Vercel

## Estructura del Monorepo

mitaller/
‚îú‚îÄ‚îÄ backend/          # Django REST API
‚îÇ   ‚îú‚îÄ‚îÄ config/       # Settings del proyecto
‚îÇ   ‚îú‚îÄ‚îÄ accounts/     # Custom User + Auth
‚îÇ   ‚îú‚îÄ‚îÄ artists/      # Perfiles de artesanos
‚îÇ   ‚îú‚îÄ‚îÄ works/        # Portfolio items
‚îÇ   ‚îî‚îÄ‚îÄ shop/         # Productos + Orders
‚îî‚îÄ‚îÄ frontend/         # Next.js App Router
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ app/      # Routes (App Router)
        ‚îú‚îÄ‚îÄ components/
        ‚îú‚îÄ‚îÄ lib/      # Utils + API client
        ‚îî‚îÄ‚îÄ stores/   # Zustand stores

## Apps Django y Responsabilidades

### accounts (Auth + Users)
- Custom User model (email como username)
- Roles: CUSTOMER, ARTISAN_PENDING, ARTISAN_VERIFIED, ADMIN
- JWT authentication (register, login, refresh, logout)
- Email verification (futuro)

### artists (Perfiles P√∫blicos)
- ArtistProfile model (1:1 con User)
- Campos: slug, display_name, bio, avatar, location (pueblo Menorca), craft_type
- Stripe: stripe_account_id, onboarding_completed (futuro)
- URLs p√∫blicas: /api/artists/, /api/artists/{slug}/

### works (Portfolio)
- Work model: t√≠tulo, descripci√≥n, categor√≠a, media_urls[], thumbnail_url
- ForeignKey a ArtistProfile
- display_order para drag & drop
- Solo el artesano due√±o puede editar sus obras

### shop (E-commerce)
- Product model: nombre, precio, stock, imagen, shipping_options
- Order model: multi-vendor, status, stripe_session_id
- OrderItem: relaciona Order con Product y ArtistProfile (para comisiones)
- Solo el artesano due√±o puede editar sus productos

## Convenciones de C√≥digo

### Python (Backend)
- Style: PEP 8 estricto
- Type hints: Usar siempre que sea posible
- Docstrings: Google style para funciones complejas
- Imports: isort con perfil "black"
- Naming:
  * Variables/funciones: snake_case
  * Clases: PascalCase
  * Constantes: UPPER_SNAKE_CASE

### TypeScript (Frontend)
- Style: Airbnb + Prettier
- Strict mode: habilitado
- Naming:
  * Variables/funciones: camelCase
  * Componentes: PascalCase
  * Constantes: UPPER_SNAKE_CASE
  * Tipos/Interfaces: PascalCase con prefijo I (IUser, IArtist)

### CSS (Tailwind)
- Preferir utilities de Tailwind
- Custom CSS solo cuando sea necesario (usar BEM)
- Responsive: mobile-first (sm:, md:, lg:, xl:)

## Patrones de Dise√±o

### Backend (Django)
- Views: Class-Based Views con ViewSets (DRF)
- Serializers: ModelSerializer con validaciones custom
- Permissions: Custom permissions (IsArtistOwner, IsVerifiedArtisan)
- URLs: Routers de DRF, versionado /api/v1/
- Queries: Usar select_related/prefetch_related para optimizar
- Transactions: Usar transaction.atomic() en operaciones cr√≠ticas

### Frontend (Next.js)
- Components: Server Components por defecto
- Client Components: Solo cuando necesites interactividad (use* hooks)
- Data fetching: Server Components cuando sea posible, TanStack Query para client
- State management:
  * Local: useState, useReducer
  * Global: Zustand (auth, cart)
  * Server: Next.js cache, TanStack Query
- Forms: React Hook Form + zod validation
- Error handling: Error boundaries + try/catch apropiados

## Calidad de C√≥digo y Mejores Pr√°cticas

### üéØ Principios Fundamentales

**NUNCA:**
- ‚ùå Implementar parches temporales o "quick fixes" que oculten el problema real
- ‚ùå A√±adir excepciones especiales en c√≥digo global (code smell)
- ‚ùå Crear soluciones "fire-and-forget" sin manejo de errores
- ‚ùå Dejar c√≥digo espagueti o dif√≠cil de mantener
- ‚ùå Asumir que "funciona" es suficiente sin considerar arquitectura
- ‚ùå Ignorar code smells con la excusa de "hacerlo despu√©s"

**SIEMPRE:**
- ‚úÖ Identificar y resolver la causa ra√≠z del problema
- ‚úÖ Escribir c√≥digo limpio, mantenible y escalable desde el inicio
- ‚úÖ Seguir el orden l√≥gico de operaciones (servidor ‚Üí cliente ‚Üí UI)
- ‚úÖ Implementar manejo robusto de errores (try-catch-finally)
- ‚úÖ Documentar decisiones t√©cnicas importantes
- ‚úÖ Refactorizar cuando detectes un mal olor en el c√≥digo

### üèóÔ∏è Arquitectura Profesional

#### 1. Flujo Correcto de Operaciones

**Ejemplo: Logout**
```typescript
// ‚úÖ CORRECTO: Backend primero, limpieza local despu√©s
logout: async () => {
  try {
    // 1. Invalidar en servidor (con token v√°lido)
    await backend.logout();
  } catch (error) {
    // 2. Manejo graceful si falla
    console.warn('Backend failed, continuing cleanup');
  } finally {
    // 3. Limpieza local (siempre se ejecuta)
    clearLocalState();
    // 4. UI feedback
    showToast();
    redirect();
  }
}

// ‚ùå INCORRECTO: Limpieza local primero
logout: () => {
  clearLocalState();  // Token eliminado
  backend.logout();   // Falla: no hay token
  redirect();         // Interceptor redirige a /login antes
}
```

**Principio:** Operaciones cr√≠ticas de servidor primero, estado local despu√©s.

#### 2. Manejo de Errores Robusto

**Backend (Python):**
```python
# ‚úÖ CORRECTO: Try-except con contexto espec√≠fico
try:
    profile = ArtistProfile.objects.get(slug=slug)
    profile.update_stripe_account(account_id)
    profile.save()
except ArtistProfile.DoesNotExist:
    logger.error(f"Artist profile not found: {slug}")
    raise Http404("Perfil no encontrado")
except StripeError as e:
    logger.error(f"Stripe API error: {str(e)}")
    raise ValidationError("Error al conectar con Stripe")
except Exception as e:
    logger.critical(f"Unexpected error: {str(e)}")
    raise

# ‚ùå INCORRECTO: Catch gen√©rico sin contexto
try:
    # ... c√≥digo
except:
    pass  # Silent failure
```

**Frontend (TypeScript):**
```typescript
// ‚úÖ CORRECTO: Manejo espec√≠fico con fallback
async function fetchArtist(slug: string): Promise<Artist> {
  try {
    const response = await api.get(`/artists/${slug}/`);
    return response.data;
  } catch (error) {
    if (error.response?.status === 404) {
      throw new NotFoundError('Artista no encontrado');
    }
    if (error.response?.status >= 500) {
      throw new ServerError('Error del servidor');
    }
    throw new NetworkError('Error de conexi√≥n');
  }
}

// ‚ùå INCORRECTO: Catch sin tipar
try {
  const data = await api.get(url);
} catch (e) {
  console.log(e);  // ¬øQu√© hacemos con el error?
}
```

#### 3. C√≥digo Auto-Documentado

**Usa nombres descriptivos:**
```typescript
// ‚úÖ CORRECTO: Intenci√≥n clara
async function invalidateUserSessionOnServer(userId: number): Promise<void> {
  await axiosInstance.post('/api/v1/auth/logout/');
}

// ‚ùå INCORRECTO: Nombre ambiguo
async function doLogout(): Promise<void> {
  // ¬øQu√© hace exactamente?
}
```

**Comentarios explican el "por qu√©", no el "qu√©":**
```python
# ‚úÖ CORRECTO: Explica la decisi√≥n
# Guardamos el thumbnail por separado para optimizar la carga inicial de la galer√≠a
# Las im√°genes completas se cargan bajo demanda (lazy loading)
thumbnail_url = cloudinary.upload(image, transformation={
    'width': 400,
    'height': 300,
    'crop': 'fill'
})

# ‚ùå INCORRECTO: Repite el c√≥digo
# Subir thumbnail
thumbnail_url = cloudinary.upload(image, ...)
```

#### 4. Principio DRY pero con Sentido Com√∫n

```typescript
// ‚úÖ CORRECTO: Abstracci√≥n √∫til
function createAuthenticatedRequest(endpoint: string, data: unknown) {
  return axiosInstance.post(endpoint, data, {
    headers: { Authorization: `Bearer ${getToken()}` }
  });
}

// ‚ùå INCORRECTO: Sobre-abstracci√≥n innecesaria
function get(url) { return fetch(url); }
function post(url, data) { return fetch(url, {method: 'POST', body: data}); }
// ... Mejor usar una librer√≠a como axios
```

#### 5. Single Responsibility Principle

```python
# ‚úÖ CORRECTO: Responsabilidades separadas
class OrderService:
    def create_order(self, cart_items: List[CartItem]) -> Order:
        order = self._build_order(cart_items)
        self._validate_stock(cart_items)
        self._process_payment(order)
        self._send_confirmation_email(order)
        return order

# ‚ùå INCORRECTO: Funci√≥n monol√≠tica
def create_order_and_do_everything(items):
    # 200 l√≠neas de c√≥digo mezclando validaci√≥n, 
    # pago, emails, notificaciones, etc.
```

### üö® Code Smells Comunes y C√≥mo Evitarlos

#### 1. Excepciones Especiales (Ejemplo Real)

```typescript
// ‚ùå INCORRECTO: Parche en interceptor
if (error.response?.status === 401) {
  // Excepci√≥n especial para logout
  if (url.includes('/auth/logout/')) {
    return Promise.reject(error);  // Code smell
  }
  // ... resto del c√≥digo
}

// ‚úÖ CORRECTO: Resolver la causa ra√≠z
// Cambiar el orden en authStore.logout() para que
// llame al backend ANTES de eliminar el token
```

#### 2. Estado Temporal Fr√°gil

```typescript
// ‚ùå INCORRECTO: Confiar en sessionStorage
logout: () => {
  sessionStorage.setItem('logout_success', 'true');
  clearTokens();
  redirect('/');
}
// En home:
useEffect(() => {
  if (sessionStorage.getItem('logout_success')) {
    toast.success('...');
    sessionStorage.removeItem('logout_success');
  }
}, []);

// ‚úÖ CORRECTO: Operaci√≥n at√≥mica
logout: async () => {
  await backend.logout();
  clearTokens();
  toast.success('...');
  setTimeout(() => redirect('/'), 800);
}
```

#### 3. Callbacks Hell

```typescript
// ‚ùå INCORRECTO: Pyramid of doom
function processOrder(orderId, callback) {
  getOrder(orderId, (order) => {
    validateStock(order, (valid) => {
      if (valid) {
        processPayment(order, (payment) => {
          sendConfirmation(order, payment, (sent) => {
            callback(null, order);
          });
        });
      }
    });
  });
}

// ‚úÖ CORRECTO: Async/await limpio
async function processOrder(orderId: number): Promise<Order> {
  const order = await getOrder(orderId);
  const isValid = await validateStock(order);
  
  if (!isValid) throw new ValidationError('Stock insuficiente');
  
  const payment = await processPayment(order);
  await sendConfirmation(order, payment);
  
  return order;
}
```

### üìè M√©tricas de C√≥digo de Calidad

**Antes de hacer commit, preg√∫ntate:**

1. **¬øEs mantenible?** ¬øLo entender√°s en 6 meses?
2. **¬øEs escalable?** ¬øFunciona con 1 usuario y con 10,000?
3. **¬øEs testeable?** ¬øPuedes escribir tests f√°cilmente?
4. **¬øEs resiliente?** ¬øManeja errores gracefully?
5. **¬øEs limpio?** ¬øHay code smells evidentes?

**Si la respuesta a alguna es "No", refactoriza antes de continuar.**

### üéì Ejemplo Completo: Logout Profesional

**Antes (Con problemas):**
```typescript
logout: () => {
  removeAllTokens();              // 1. Elimina tokens primero
  axiosInstance.post('/logout/'); // 2. Backend falla (401)
  window.location.href = '/';     // 3. Interceptor redirige a /login
}
```

**Problemas:**
- ‚ùå Orden incorrecto de operaciones
- ‚ùå Backend no puede invalidar token
- ‚ùå Interceptor causa redirect inesperado
- ‚ùå No hay manejo de errores
- ‚ùå Code smell: necesita excepci√≥n en interceptor

**Despu√©s (Profesional):**
```typescript
/**
 * Cierra sesi√≥n del usuario
 * 
 * Flujo:
 * 1. Invalida token en servidor (permite blacklist)
 * 2. Limpia estado local (garantizado con finally)
 * 3. Muestra feedback y redirige
 */
logout: async () => {
  try {
    // Backend primero (con token v√°lido)
    await axiosInstance.post('/api/v1/auth/logout/');
  } catch (error) {
    // Graceful degradation si backend falla
    console.warn('Backend logout failed, continuing with local cleanup:', error);
  } finally {
    // Limpieza local (siempre se ejecuta)
    removeAllTokens();
    set({ user: null, isAuthenticated: false });
    
    // UI feedback
    toast.success('Sesi√≥n cerrada exitosamente');
    setTimeout(() => window.location.href = '/', 800);
  }
}
```

**Ventajas:**
- ‚úÖ Orden l√≥gico: servidor ‚Üí cliente ‚Üí UI
- ‚úÖ Backend puede hacer blacklist
- ‚úÖ Manejo robusto de errores
- ‚úÖ Limpieza garantizada (finally)
- ‚úÖ Sin code smells ni parches
- ‚úÖ C√≥digo auto-documentado
- ‚úÖ Testeable y mantenible

## API Design

### Endpoints RESTful
GET    /api/artists/              # Listar artistas (p√∫blico)
GET    /api/artists/{slug}/       # Detalle artista (p√∫blico)
POST   /api/artists/              # Crear perfil (auth requerido)
PUT    /api/artists/{slug}/       # Actualizar (owner only)

GET    /api/works/                # Listar obras (p√∫blico, filtrable por artist)
POST   /api/works/                # Crear obra (artisan verified)
PUT    /api/works/{id}/           # Actualizar (owner only)
DELETE /api/works/{id}/           # Eliminar (owner only)

GET    /api/products/             # Listar productos (p√∫blico)
POST   /api/products/             # Crear producto (artisan verified)
POST   /api/orders/               # Crear orden (customer)
GET    /api/orders/me/            # Mis √≥rdenes (auth)

### Response format
Success:
{
  "success": true,
  "data": {...},
  "message": "Success message"
}

Error:
{
  "success": false,
  "error": "Error message",
  "details": {...}
}

## Seguridad

### Backend
- CORS: Solo frontend (local + producci√≥n)
- JWT: Access token (15min) + Refresh token (7 d√≠as)
- Permissions: Verificar en CADA endpoint (IsAuthenticated, IsArtistOwner)
- Input validation: Serializers + custom validators
- SQL Injection: ORM previene (no raw queries sin parametrizar)
- Secrets: Siempre en .env, nunca commitear

### Frontend
- JWT: Almacenar en httpOnly cookie (preferido) o localStorage (fallback)
- CSRF: Next.js maneja autom√°ticamente en Server Actions
- XSS: React escapa autom√°ticamente, cuidado con dangerouslySetInnerHTML
- Env vars: NEXT_PUBLIC_* solo para p√∫blicas, secretas en server-side

## Testing (Fase futura)

### Backend
- Framework: pytest + pytest-django
- Coverage m√≠nimo: 80%
- Tests cr√≠ticos: Auth, Payments, Permissions
- Fixtures: factory_boy para datos de prueba

### Frontend
- Framework: Vitest + React Testing Library
- E2E cr√≠ticos: Playwright (registro ‚Üí login ‚Üí crear producto ‚Üí compra)

## Git Workflow

### Commits
Conventional Commits:
- feat: Nueva feature
- fix: Bug fix
- refactor: Refactoring sin cambio funcional
- docs: Documentaci√≥n
- test: Tests
- chore: Tareas mantenimiento

Ejemplos:
feat(artists): add bio field to artist profile
fix(auth): resolve JWT refresh token expiry issue
refactor(shop): optimize product query with select_related

### Branches (cuando sea necesario)
- main: Producci√≥n estable
- develop: Desarrollo activo (por ahora trabaja directo en main)
- feature/nombre: Features nuevas (futuro)

## Reglas de Generaci√≥n de C√≥digo

Cuando generes c√≥digo, SIEMPRE:

1. **Resuelve la causa ra√≠z, no los s√≠ntomas**
   - ‚ùå No a√±adas excepciones especiales o parches temporales
   - ‚úÖ Identifica por qu√© ocurre el problema y arr√©glalo en origen
   - Si algo requiere una "excepci√≥n especial", el dise√±o est√° mal

2. **Sigue el orden l√≥gico de operaciones**
   - Servidor primero (invalidar, guardar, actualizar)
   - Cliente despu√©s (estado local, cache)
   - UI al final (feedback, redirects)

3. **Maneja errores de forma robusta**
   - Backend: try/except espec√≠ficos con logging contextual
   - Frontend: try-catch-finally con graceful degradation
   - Nunca silenciar errores (catch sin manejo)
   - Logs √∫tiles: qu√© fall√≥, por qu√©, d√≥nde

4. **Escribe c√≥digo mantenible desde el inicio**
   - Preg√∫ntate: ¬øLo entender√© en 6 meses?
   - Refactoriza cuando detectes code smells
   - Nombres descriptivos > comentarios explicativos
   - Funciones peque√±as con responsabilidad √∫nica

5. **Explica decisiones t√©cnicas importantes**
   - ¬øPor qu√© elegiste este approach?
   - ¬øQu√© alternativas consideraste?
   - ¬øQu√© trade-offs tiene?

6. **Incluye comentarios para el "por qu√©", no el "qu√©"**
   ```python
   # ‚úÖ BIEN: Explica la decisi√≥n de negocio
   # Guardamos thumbnail separado para optimizar carga inicial
   thumbnail_url = cloudinary.upload(...)
   
   # ‚ùå MAL: Repite lo que dice el c√≥digo
   # Subir imagen a cloudinary
   thumbnail_url = cloudinary.upload(...)
   ```

7. **Valida inputs y outputs**
   - Backend: Serializers + custom validators
   - Frontend: zod schemas + type guards
   - Nunca conf√≠es en datos externos

8. **Usa type hints y tipos siempre**
   ```python
   # Python
   def create_artist_profile(user: User, data: dict) -> ArtistProfile:
   ```
   ```typescript
   // TypeScript
   function createOrder(items: ICartItem[]): Promise<IOrder>
   ```

9. **Verifica que el c√≥digo sea:**
   - ‚úÖ Mantenible (legible en 6 meses)
   - ‚úÖ Escalable (funciona con 1 y 10,000 usuarios)
   - ‚úÖ Testeable (f√°cil escribir tests)
   - ‚úÖ Resiliente (maneja errores gracefully)
   - ‚úÖ Limpio (sin code smells)

10. **Sigue las convenciones del proyecto**
    - Naming, estructura, patterns
    - Consulta secci√≥n "Calidad de C√≥digo" arriba

## Documentaci√≥n

### Estructura de Documentaci√≥n
El proyecto tiene 3 niveles de documentaci√≥n organizados:

```
mitaller/
‚îú‚îÄ‚îÄ docs/              # Documentaci√≥n general del proyecto
‚îÇ   ‚îú‚îÄ‚îÄ README.md      # √çndice principal
‚îÇ   ‚îú‚îÄ‚îÄ architecture/  # Dise√±o t√©cnico, conceptos
‚îÇ   ‚îú‚îÄ‚îÄ auth/          # Sistema de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ deployment/    # Deploy, dependencias
‚îÇ   ‚îú‚îÄ‚îÄ phases/        # Fases del proyecto
‚îÇ   ‚îú‚îÄ‚îÄ troubleshooting/ # Problemas resueltos
‚îÇ   ‚îî‚îÄ‚îÄ .templates/    # Plantillas
‚îú‚îÄ‚îÄ backend/docs/      # Documentaci√≥n espec√≠fica del backend
‚îÇ   ‚îú‚îÄ‚îÄ README.md      # √çndice backend
‚îÇ   ‚îú‚îÄ‚îÄ modules/       # Por app Django (accounts, artists, etc.)
‚îÇ   ‚îî‚îÄ‚îÄ config/        # Configuraci√≥n backend
‚îî‚îÄ‚îÄ frontend/docs/     # Documentaci√≥n espec√≠fica del frontend
    ‚îú‚îÄ‚îÄ README.md      # √çndice frontend
    ‚îú‚îÄ‚îÄ auth/          # Auth frontend
    ‚îú‚îÄ‚îÄ config/        # Env vars, setup
    ‚îú‚îÄ‚îÄ guides/        # Hooks, types, layouts
    ‚îú‚îÄ‚îÄ features/      # Features espec√≠ficas
    ‚îî‚îÄ‚îÄ placeholders/  # Sistema de placeholders
```

### Cu√°ndo Documentar

**SIEMPRE documenta:**
- Nueva feature compleja (usa plantilla `feature-template.md`)
- Problema resuelto que tom√≥ >1h (usa plantilla `troubleshooting-template.md`)
- Cambio arquitect√≥nico significativo
- Nueva integraci√≥n (Stripe, Cloudinary, etc.)
- Proceso de setup no obvio

**NO hace falta documentar:**
- CRUD simple siguiendo patrones existentes
- Cambios menores de UI
- Fixes triviales de typos o estilos

### D√≥nde Colocar la Documentaci√≥n

**Documentaci√≥n General** ‚Üí `docs/`:
- Arquitectura del sistema completo
- Decisiones de dise√±o transversales
- Autenticaci√≥n (flujo completo backend+frontend)
- Troubleshooting general

**Backend espec√≠fico** ‚Üí `backend/docs/modules/{app}/`:
- Gu√≠as de API de un m√≥dulo Django
- Modelos complejos con l√≥gica de negocio
- Integraciones backend (Stripe Connect)
- Cada app mantiene su README.md en la carpeta de la app

**Frontend espec√≠fico** ‚Üí `frontend/docs/`:
- Hooks personalizados complejos
- Componentes reutilizables avanzados
- Gu√≠as de tipos TypeScript
- Setup de herramientas (Cloudinary upload)

### Formato de Documentaci√≥n

**Estructura de archivo:**
```markdown
# T√≠tulo Descriptivo

> Breve descripci√≥n (1-2 l√≠neas)

## üìã Contexto
¬øQu√© problema resuelve? ¬øPor qu√© es necesario?

## üõ†Ô∏è Implementaci√≥n
### Backend (si aplica)
- C√≥digo clave
- Endpoints afectados

### Frontend (si aplica)
- Componentes principales
- Hooks/utils usados

## ‚úÖ Uso
Ejemplos pr√°cticos de c√≥mo usar

## üêõ Known Issues / Limitaciones
(si hay)

---
**Autor**: [nombre]  
**Fecha**: [YYYY-MM-DD]
```

**Estilo:**
- Emojis para secciones (üìã üìä üõ†Ô∏è ‚úÖ üêõ ‚ö°)
- Code blocks con sintaxis highlight
- Enlaces internos a otros docs cuando sea relevante
- Screenshots solo si aportan valor real

### Plantillas Disponibles

**Para nueva feature:**
```bash
cp docs/.templates/feature-template.md docs/features/mi-feature.md
# O en m√≥dulo espec√≠fico:
cp docs/.templates/feature-template.md backend/docs/modules/payments/feature-name.md
```

**Para problema resuelto:**
```bash
cp docs/.templates/troubleshooting-template.md docs/troubleshooting/problema-xyz.md
```

### Ejemplo de Cu√°ndo Usar Cada Ubicaci√≥n

**Caso 1: Nueva feature de galer√≠a con lightbox**
- Afecta solo frontend
- **Ubicaci√≥n**: `frontend/docs/features/GALERIA_LIGHTBOX.md`
- **Incluir**: Componentes, hooks, gu√≠a de uso

**Caso 2: Integraci√≥n Stripe Connect**
- Afecta backend principalmente
- **Ubicaci√≥n**: `backend/docs/modules/payments/STRIPE_CONNECT_GUIDE.md`
- **Incluir**: Webhooks, API calls, testing en dev

**Caso 3: Sistema de autenticaci√≥n JWT completo**
- Afecta backend + frontend
- **Ubicaci√≥n**: `docs/auth/SISTEMA_AUTENTICACION.md`
- **Incluir**: Flujo completo, decisiones arquitect√≥nicas

**Caso 4: Bug de logout que borraba tokens incorrectamente**
- Problema espec√≠fico resuelto
- **Ubicaci√≥n**: `docs/troubleshooting/PROBLEMA_LOGOUT.md`
- **Incluir**: S√≠ntomas, causa ra√≠z, soluci√≥n, verificaci√≥n

### Reglas para el AI

Cuando generes c√≥digo que requiera documentaci√≥n:

1. **Pregunta d√≥nde documentar** si no est√° claro
2. **Usa las plantillas** apropiadas
3. **Actualiza √≠ndices** (README.md de cada docs/)
4. **Enlaza desde el c√≥digo** si es relevante:
   ```python
   # Ver documentaci√≥n completa en backend/docs/modules/payments/STRIPE_CONNECT_GUIDE.md
   ```
5. **Mant√©n la documentaci√≥n cerca del c√≥digo conceptualmente**
   - Feature de artists ‚Üí backend/docs/modules/artists/
   - No todo en docs/ ra√≠z

### ‚ö†Ô∏è REGLA CR√çTICA: Documentaci√≥n Siempre Actualizada

**NUNCA dejes documentaci√≥n desactualizada:**

1. **Cuando cambies c√≥digo, actualiza la documentaci√≥n relacionada INMEDIATAMENTE**
   - Si cambias una API, actualiza su documentaci√≥n
   - Si corriges un bug documentado, actualiza el troubleshooting
   - Si refactorizas, actualiza los ejemplos de c√≥digo

2. **NO marques documentos como "desactualizados" o "obsoletos"**
   - ‚ùå MAL: A√±adir "‚ö†Ô∏è DOCUMENTO DESACTUALIZADO"
   - ‚úÖ BIEN: Actualizar el contenido directamente
   - Si necesitas refactorizar documentaci√≥n, hazlo, no la marques

3. **Busca documentos relacionados antes de terminar**
   - Usa grep para buscar referencias al c√≥digo que cambias
   - Ejemplo: Si cambias signed uploads, busca "signed upload" en docs/
   - Actualiza TODOS los documentos que mencionen la feature

4. **Verifica la consistencia de ejemplos de c√≥digo**
   - Los code snippets deben reflejar el c√≥digo actual
   - Las configuraciones deben estar actualizadas
   - Los comandos deben ser los correctos

5. **Actualiza fechas y versiones**
   - Cambia "√öltima actualizaci√≥n" al final de los docs
   - Si cambias significativamente un doc, actualiza su fecha

**Ejemplo de workflow correcto:**

```
1. Usuario pide cambiar c√≥digo X
2. Haces el cambio en el c√≥digo
3. ANTES de terminar, buscas: grep -r "c√≥digo X" docs/
4. Actualizas TODOS los docs que mencionan X
5. Verificas que los ejemplos funcionen
6. Actualizas fechas
7. ENTONCES terminas la tarea
```

**Por qu√© es cr√≠tico:**
- Documentaci√≥n desactualizada es PEOR que no tener documentaci√≥n
- Causa confusi√≥n y p√©rdida de tiempo
- Rompe la confianza en la documentaci√≥n
- El proyecto pierde su "fuente de verdad"

## Contexto de Negocio (NO OLVIDAR)

- Comisi√≥n: 12% fija en MVP (futuro: 15% free, 8% pro + 20‚Ç¨/mes)
- Verificaci√≥n: Manual por admin (cambiar role PENDING ‚Üí VERIFIED)
- Env√≠os: Cada artesano define precios (local/pen√≠nsula/internacional)
- MVP Scope: Auth + Artistas + Portfolio + Shop + Pagos (sin reviews, mapa, eventos)
- Target: 10-15 artesanos piloto en 12 semanas

## Referencias

- Marina (proyecto anterior): /marina-backend, /marina-frontend
  ‚Üí Reutilizar l√≥gica de upload Cloudinary, drag & drop, auth flow
- Django Docs: https://docs.djangoproject.com/
- DRF Docs: https://www.django-rest-framework.org/
- Next.js Docs: https://nextjs.org/docs
- shadcn/ui: https://ui.shadcn.com/

## Notas Importantes

- Este es un MONOREPO: backend y frontend en el mismo repo
- Deploy separado: Railway (backend) + Vercel (frontend)
- Cursor puede ver TODO el contexto del proyecto
- Al responder, pregunta si algo no est√° claro antes de asumir