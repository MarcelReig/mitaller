# An√°lisis de Rutas y Vistas - Mitaller.art

**Fecha:** Octubre 2025
**Objetivo:** Identificar rutas y vistas redundantes o sin utilizar

---

## üìã RESUMEN EJECUTIVO

### Backend Django - ‚úÖ LIMPIO
- **7 apps** con rutas bien organizadas
- **Todas las rutas est√°n conectadas** a vistas activas
- **Sin redundancias** detectadas en URLs o ViewSets
- **2 scripts de testing** manuales que podr√≠an moverse a `/tests`

### Frontend Next.js - ‚ö†Ô∏è LIMPIEZA REQUERIDA
- **1 ruta obsoleta** encontrada: `/artistas/[slug]`
- **1 directorio vac√≠o** sin contenido: `/artesanos/`
- **Ruta correcta en uso:** `/(public)/artesanos/[slug]`

---

## üîç AN√ÅLISIS DETALLADO

### 1Ô∏è‚É£ BACKEND DJANGO

#### ‚úÖ Rutas Principales (`config/urls.py`)
Todas las rutas est√°n bien conectadas:

```python
/admin/                        ‚Üí Django Admin
/api/v1/auth/                  ‚Üí accounts.urls (login, registro, perfil)
/api/v1/auth/token/verify/     ‚Üí TokenVerifyView (JWT)
/api/v1/artists/               ‚Üí artists.urls (perfiles p√∫blicos)
/api/v1/works/                 ‚Üí works.urls (portfolio)
/api/v1/shop/                  ‚Üí shop.urls (productos)
/api/v1/orders/                ‚Üí orders.urls (pedidos)
/api/v1/payments/              ‚Üí payments.urls (Stripe)
```

#### ‚úÖ App: `accounts` - Autenticaci√≥n
**Archivo:** `accounts/urls.py`

| Ruta | Vista | Estado | Uso |
|------|-------|--------|-----|
| `/register/` | `RegisterView` | ‚úÖ Activa | Registro de artesanos |
| `/login/` | `CustomTokenObtainPairView` | ‚úÖ Activa | Login JWT |
| `/token/refresh/` | `TokenRefreshView` | ‚úÖ Activa | Refresh tokens |
| `/logout/` | `LogoutView` | ‚úÖ Activa | Blacklist tokens |
| `/profile/` | `UserProfileView` | ‚úÖ Activa | Ver/editar perfil |
| `/debug/` | `DebugAuthView` | ‚ö†Ô∏è Solo dev | Debugging auth |

**Notas:**
- Todas las vistas est√°n implementadas y en uso
- `/debug/` solo para desarrollo (considera proteger con `DEBUG=True` check)

---

#### ‚úÖ App: `artists` - Perfiles de Artesanos
**Archivo:** `artists/urls.py`

Usa `DefaultRouter` de DRF con `ArtistProfileViewSet`:

| Endpoint | M√©todo | Acci√≥n | Estado |
|----------|--------|--------|--------|
| `/` | GET | `list` | ‚úÖ Lista artesanos |
| `/{slug}/` | GET | `retrieve` | ‚úÖ Detalle artesano |
| `/me/` | GET | Custom action | ‚úÖ Perfil propio |
| `/me/` | PATCH | Custom action | ‚úÖ Editar perfil |
| `/{slug}/works/` | GET | Custom action | ‚úÖ Obras del artesano |

**Notas:**
- ViewSet ReadOnly para p√∫blico
- Custom action `/me/` para edici√≥n propia
- Custom action `/{slug}/works/` usado por frontend
- Sin redundancias

---

#### ‚úÖ App: `works` - Portfolio de Obras
**Archivo:** `works/urls.py`

| Endpoint | Vista/ViewSet | Estado | Uso |
|----------|---------------|--------|-----|
| `/cloudinary/signature/` | `generate_upload_signature` | ‚úÖ Activa | Signed uploads |
| `/cloudinary/config/` | `cloudinary_config` | ‚úÖ Activa | Config p√∫blica |
| `/` (router) | `WorkViewSet` | ‚úÖ Activo | CRUD obras |
| `/reorder/` | `WorkViewSet.reorder` | ‚úÖ Activa | Reordenar obras |

**Vistas en `cloudinary_views.py`:**
- `generate_upload_signature` ‚Üí ‚úÖ En uso (signed uploads)
- `cloudinary_config` ‚Üí ‚úÖ En uso (config frontend)

**Notas:**
- ModelViewSet completo (list, retrieve, create, update, destroy)
- Custom action `reorder` para drag & drop
- Cloudinary views separadas en archivo propio (buena pr√°ctica)

---

#### ‚úÖ App: `shop` - Productos
**Archivo:** `shop/urls.py`

Usa `DefaultRouter` con `ProductViewSet`:

| Endpoint | M√©todo | Acci√≥n | Estado |
|----------|--------|--------|--------|
| `/` | GET | `list` | ‚úÖ Lista productos |
| `/{id}/` | GET | `retrieve` | ‚úÖ Detalle producto |
| `/` | POST | `create` | ‚úÖ Crear producto |
| `/{id}/` | PATCH/PUT | `update` | ‚úÖ Editar producto |
| `/{id}/` | DELETE | `destroy` | ‚úÖ Eliminar producto |

**Notas:**
- ModelViewSet completo
- Filtros por artista, categor√≠a, estado
- B√∫squeda por nombre/descripci√≥n
- Sin redundancias

---

#### ‚úÖ App: `orders` - Pedidos
**Archivo:** `orders/urls.py`

| Endpoint | M√©todo | Acci√≥n | Estado |
|----------|--------|--------|--------|
| `/` | GET | `list` | ‚úÖ Lista pedidos |
| `/{id}/` | GET | `retrieve` | ‚úÖ Detalle pedido |
| `/` | POST | `create` | ‚úÖ Crear pedido (p√∫blico) |
| `/{id}/` | PATCH | `partial_update` | ‚úÖ Actualizar estado |
| `/my-sales/` | GET | Custom action | ‚úÖ Ventas del artesano |

**Notas:**
- Custom action `/my-sales/` retorna `OrderItems` del artesano
- Endpoint `/` p√∫blico para compras de invitados
- Sin redundancias

---

#### ‚úÖ App: `payments` - Pagos con Stripe
**Archivo:** `payments/urls.py`

| Endpoint | Vista/ViewSet | Estado | Uso |
|----------|---------------|--------|-----|
| `/webhook/stripe/` | `StripeWebhookView` | ‚úÖ Activa | Webhooks Stripe |
| `/stripe-connect/` (router) | `StripeConnectViewSet` | ‚úÖ Activo | Onboarding |
| `/stripe-connect/start-onboarding/` | Custom action | ‚úÖ Activa | Iniciar onboarding |
| `/stripe-connect/refresh-onboarding/` | Custom action | ‚úÖ Activa | Refrescar link |
| `/stripe-connect/account-status/` | Custom action | ‚úÖ Activa | Estado cuenta |
| `/payments/` (router) | `PaymentViewSet` | ‚úÖ Activo | Lista pagos |
| `/payments/create-checkout-session/` | Custom action | ‚úÖ Activa | Crear sesi√≥n |

**Notas:**
- Webhook de Stripe antes del router (orden importante)
- Todas las custom actions en uso
- Sin redundancias

---

### 2Ô∏è‚É£ FRONTEND NEXT.JS

#### ‚ö†Ô∏è Rutas Obsoletas - ACCI√ìN REQUERIDA

##### 1. `/artistas/[slug]` - **ELIMINAR**

**Ubicaci√≥n:** `src/app/artistas/[slug]/page.tsx`

**Problema:**
- Ruta obsoleta que duplica funcionalidad de `/(public)/artesanos/[slug]`
- Client Component antiguo con `useState` y `useEffect`
- Solo tiene 1 referencia interna (a s√≠ misma en l√≠nea 128)
- No se usa en ninguna otra parte del c√≥digo

**Comparaci√≥n:**

| Caracter√≠stica | `/artistas/[slug]` (OBSOLETA) | `/(public)/artesanos/[slug]` (ACTUAL) |
|----------------|-------------------------------|---------------------------------------|
| Tipo | Client Component | Server Component |
| Fetch | Client-side con axios | Server-side con fetch |
| SEO | Limitado | Completo con metadata |
| Rendering | CSR | SSR |
| Referencias | 1 (a s√≠ misma) | 19 en toda la app |

**Acci√≥n:** Eliminar directorio completo `/artistas/`

---

##### 2. `/artesanos/` (directorio vac√≠o) - **ELIMINAR**

**Ubicaci√≥n:** `src/app/artesanos/`

**Problema:**
- Directorio vac√≠o sin contenido
- La funcionalidad real est√° en `/(public)/artesanos/`
- Puede causar confusi√≥n

**Acci√≥n:** Eliminar directorio vac√≠o

---

#### ‚úÖ Rutas Activas y en Uso

##### Rutas P√∫blicas `(public)/`

| Ruta | Archivo | Estado | Uso |
|------|---------|--------|-----|
| `/artesanos` | `(public)/artesanos/page.tsx` | ‚úÖ Activa | Lista artesanos |
| `/artesanos/[slug]` | `(public)/artesanos/[slug]/page.tsx` | ‚úÖ Activa | Perfil artesano (19 refs) |
| `/artesanos/[slug]/obras/[workId]` | `(public)/artesanos/[slug]/obras/[workId]/page.tsx` | ‚úÖ Activa | Detalle obra |
| `/carrito` | `(public)/carrito/page.tsx` | ‚úÖ Activa | Carrito compras |

##### Rutas de Autenticaci√≥n `(auth)/`

| Ruta | Archivo | Estado | Uso |
|------|---------|--------|-----|
| `/login` | `(auth)/login/page.tsx` | ‚úÖ Activa | Login |
| `/registro` | `(auth)/registro/page.tsx` | ‚úÖ Activa | Registro |

##### Rutas Dashboard `(dashboard)/`

| Ruta | Archivo | Estado | Uso |
|------|---------|--------|-----|
| `/dashboard` | `(dashboard)/dashboard/page.tsx` | ‚úÖ Activa | Dashboard principal |
| `/dashboard/perfil` | `(dashboard)/dashboard/perfil/page.tsx` | ‚úÖ Activa | Editar perfil |
| `/dashboard/obras` | `(dashboard)/dashboard/obras/page.tsx` | ‚úÖ Activa | Gesti√≥n obras |
| `/dashboard/obras/nueva` | `(dashboard)/dashboard/obras/nueva/page.tsx` | ‚úÖ Activa | Crear obra |
| `/dashboard/obras/[id]/editar` | `(dashboard)/dashboard/obras/[id]/editar/page.tsx` | ‚úÖ Activa | Editar obra |
| `/dashboard/tienda` | `(dashboard)/dashboard/tienda/page.tsx` | ‚úÖ Activa | Gesti√≥n productos |
| `/dashboard/pedidos` | `(dashboard)/dashboard/pedidos/page.tsx` | ‚úÖ Activa | Ver pedidos |
| `/dashboard/debug-auth` | `(dashboard)/dashboard/debug-auth/page.tsx` | ‚ö†Ô∏è Solo dev | Debug auth |

##### Rutas Artesano `(dashboard)/artesano/`

| Ruta | Archivo | Estado | Uso |
|------|---------|--------|-----|
| `/artesano` | `(dashboard)/artesano/page.tsx` | ‚úÖ Activa | Dashboard artesano |
| `/artesano/portfolio` | `(dashboard)/artesano/portfolio/page.tsx` | ‚úÖ Activa | Portfolio |
| `/artesano/productos` | `(dashboard)/artesano/productos/page.tsx` | ‚úÖ Activa | Productos |
| `/artesano/ventas` | `(dashboard)/artesano/ventas/page.tsx` | ‚úÖ Activa | Ventas |

**Nota:** Parece haber duplicaci√≥n entre `/dashboard/*` y `/artesano/*`. ¬øSon para roles diferentes o es redundancia?

---

### 3Ô∏è‚É£ SCRIPTS DE TESTING

#### ‚ö†Ô∏è Scripts en directorio ra√≠z - CONSIDERAR MOVER

**Ubicaci√≥n:** `/backend/`

| Archivo | Prop√≥sito | Acci√≥n Sugerida |
|---------|-----------|-----------------|
| `test_auth_endpoints.py` | Testing manual de endpoints auth | Mover a `/backend/tests/manual/` |
| `test_auth_flow.py` | Testing manual de flujo completo | Mover a `/backend/tests/manual/` |
| `create_test_data.py` | Crear datos de prueba | Mantener en ra√≠z (es √∫til) |
| `create_painter_test_data.py` | Crear datos de pintores | Mantener en ra√≠z (es √∫til) |
| `limpiar_obras.py` | Script de limpieza | Mover a `/backend/scripts/` |

---

## üéØ PLAN DE ACCI√ìN

### Prioridad Alta - Limpieza Frontend

1. **Eliminar ruta obsoleta `/artistas/`**
   ```bash
   rm -rf frontend/src/app/artistas
   ```

2. **Eliminar directorio vac√≠o `/artesanos/`**
   ```bash
   rmdir frontend/src/app/artesanos
   ```

### Prioridad Media - Organizaci√≥n

3. **Crear directorio para tests manuales**
   ```bash
   mkdir -p backend/tests/manual
   mv backend/test_auth_endpoints.py backend/tests/manual/
   mv backend/test_auth_flow.py backend/tests/manual/
   ```

4. **Crear directorio para scripts**
   ```bash
   mkdir -p backend/scripts
   mv backend/limpiar_obras.py backend/scripts/
   ```

### Prioridad Baja - Revisi√≥n

5. **Revisar duplicaci√≥n `/dashboard` vs `/artesano`**
   - ¬øSon para roles diferentes?
   - ¬øSe pueden consolidar?
   - Documentar la diferencia si son necesarios ambos

6. **Proteger rutas de debug**
   - Agregar check `if settings.DEBUG` en `/debug/` endpoints
   - Considerar eliminar en producci√≥n

---

## üìä ESTAD√çSTICAS

### Backend
- **Apps:** 7 (accounts, artists, works, shop, orders, payments + config)
- **Rutas totales:** ~35 endpoints
- **Rutas redundantes:** 0 ‚úÖ
- **Rutas sin usar:** 0 ‚úÖ
- **ViewSets:** 6 (todos en uso)
- **Vistas function-based:** 3 (todas en uso)

### Frontend
- **Rutas p√∫blicas:** 4 ‚úÖ
- **Rutas auth:** 2 ‚úÖ
- **Rutas dashboard:** 8 ‚úÖ
- **Rutas artesano:** 4 ‚úÖ
- **Rutas obsoletas:** 1 ‚ö†Ô∏è (eliminar)
- **Directorios vac√≠os:** 1 ‚ö†Ô∏è (eliminar)

---

## ‚úÖ CONCLUSIONES

### Lo Bueno
- Backend muy bien organizado y sin redundancias
- Separaci√≥n clara de responsabilidades
- Uso correcto de ViewSets y custom actions
- Frontend usa Next.js App Router correctamente

### Lo Mejorable
- Eliminar ruta obsoleta `/artistas/`
- Limpiar directorio vac√≠o `/artesanos/`
- Organizar scripts de testing
- Documentar diferencia entre `/dashboard` y `/artesano`

### Riesgo
**Bajo** - Los cambios sugeridos son eliminaciones seguras de c√≥digo no utilizado.

---

## üìù NOTAS FINALES

Este an√°lisis se realiz√≥ revisando:
- Todos los archivos `urls.py` del backend
- Todos los archivos `views.py` y ViewSets
- Estructura completa de rutas del frontend Next.js
- Referencias cruzadas en todo el c√≥digo
- Uso real de cada endpoint y componente

**Recomendaci√≥n:** Proceder con la limpieza de forma incremental, empezando por la eliminaci√≥n de `/artistas/` que es claramente obsoleta y no se usa.

